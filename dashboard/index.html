<!doctype html><meta charset="utf-8"><title>Bias Mirror â€“ Group</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="./config.js"></script>
<div style="max-width:760px;margin:40px auto;font:16px system-ui;line-height:1.4">
  <h2 id="title">Group</h2>
  <p id="meta" style="color:#666"></p>
  <h3>Geographic Focus</h3>
  <canvas id="geo"></canvas>
  <h3 style="margin-top:24px">Gender Representation</h3>
  <canvas id="gender"></canvas>
</div>
<script>
const GROUP_ID = new URLSearchParams(location.search).get('g') || 'CS-201-F25';
document.getElementById('title').textContent = 'Group: ' + GROUP_ID;

const url = `${SUPABASE_URL}/rest/v1/documents?group_id=eq.${encodeURIComponent(GROUP_ID)}&select=analysis,scanned_at`;

fetch(url, { headers: { apikey: SUPABASE_ANON_KEY, Authorization:`Bearer ${SUPABASE_ANON_KEY}` } })
.then(r => r.json())
.then(rows => {
  document.getElementById('meta').textContent = `${rows.length} documents analyzed by AI`;

  // Process the AI analysis data
  const geoCounter = {};
  const genderCounter = {};

  for (const row of rows) {
    if (row.analysis) {
      const geoFocus = row.analysis.geographic_focus || "Unknown";
      const genderRep = row.analysis.gender_representation || "Unknown";
      geoCounter[geoFocus] = (geoCounter[geoFocus] || 0) + 1;
      genderCounter[genderRep] = (genderCounter[genderRep] || 0) + 1;
    }
  }

  // Render Geographic Focus Chart
  new Chart(document.getElementById('geo'), {
    type: 'bar',
    data: {
      labels: Object.keys(geoCounter),
      datasets: [{ label: 'Documents', data: Object.values(geoCounter) }]
    }
  });

  // Render Gender Representation Chart
  new Chart(document.getElementById('gender'), {
    type: 'bar',
    data: {
      labels: Object.keys(genderCounter),
      datasets: [{ label: 'Documents', data: Object.values(genderCounter) }]
    }
  });
});
</script>